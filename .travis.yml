language: node_js
sudo: required
node_js:
  - 'stable'
before_cache:
  - nix-collect-garbage -d
cache:
  directories:
    - node_modules
    - nix
  timeout: 9000
before_install:
  - . gov-testchain/install-dapptools.sh
install:
  - yarn install
script:
  - yarn testnet --ci yarn test
before_deploy:
  - yarn build
  - npm install now --no-save
deploy:
  - provider: script
    script: now ./build --token $NOW_TOKEN -A ../now.json && now alias --token $NOW_TOKEN
    skip_cleanup: true
    on:
      master: true
    notifications:
      webhooks:
        secure: "fsK6wUSsJ+ggCDPm04kayQeQXFmS1neWszbQa6TNaOsahkmrf/Ict2hLIDj+wk4T79PWBmjL+zoUgPZZQbkFFY0RSF4pzt0t368Lk+YAcJ8LG8/2+TRbZ/3PRDKv3GPExRhUGMIZM3e2ReH41rmRwe7+wUWwcCLgPz931WggGp1Z5W8jIrCLOpUV6ARJz1Eyub38UGMFoDrKyvd5N911oS3JWzcRfVYTNsip9crh8I47NPMztnqsjkQd84GCpf7119YfzYrApZuv0cLl0yd/7kX/wLMA4w35s8OAMsFiy+70H/LHp3JVInwC7dfHOdg00fCwaqaoOqcM38rZoQmbeVqJqGg5k3FdENwYi1Au7MzECTzwy5k2sASmxTA1XVAKYeC8BO9nf1xaWnlV2wTSHuTTKn5wHTkldGPnJw65HKIMT7XeduwkaqwbjX42pPwXuWPDB417KRYeY17/eUE4AESYepqcjwTilRHi+9PXDnPOM7WVTP1Gq0t9nu4OXBXNPx7qZnPIseb/3csuNThXXs8uqAdriPNgCpTAeBGzvuzx2WtvFlUYA/chuyf9mRjEua5+Y2EFCcWjMYBXe+x1sxeLhXC00jGIeHR7UBHfbC8t4wcqx+2AzSo79ivIoSO0esB//AqFYhFPCjKaafKoc7o+CLHnlvYRXbsC8h8GDM8="
